{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TrailLend Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root{
      --indigo:#1F1B4F;
      --gold:#FAB417;
      --bg:#F5F5F5;
      --text:#000;
      --border:#eee;
    }

    body { margin:0; font-family: Arial, sans-serif; background-color: var(--bg); color: var(--text); }

    /* Sidebar */
    .sidebar{
      position: fixed; top:0; left:0; width:70px; height:100vh; background-color:var(--indigo);
      display:flex; flex-direction:column; align-items:center; padding-top:20px;
    }
    .sidebar img.logo{ width:70px; height:70px; margin-bottom:40px; }
    .sidebar a i{ color:#fff; font-size:25px; margin:20px 0; cursor:pointer; }

    /* Header */
    .header{
      background-color:var(--gold); height:60px; display:flex; align-items:center;
      padding-left:80px; font-weight:bold; color:#000; font-size:20px;
    }

    /* Main */
    .main{ margin-left:70px; padding:24px; }

    /* Overview text */
    .page-title{ font-size:26px; margin:0 0 6px 0; font-weight:bold; }
    .sub-muted{ color:#444; margin:0 0 24px 0; }

    /* Cards */
    .cards{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:25px;
      margin-top:24px;
      flex-wrap:wrap;
    }
    .card{
      display:inline-block;
      border:none;
      background:none;
      text-decoration:none;
    }
    .card-img{
      width:230px;
      height:300px;
      border-radius:2px;
      object-fit:cover;
      display:block;
      cursor:pointer;
      transition: transform .12s ease;
    }
    .card-img:hover{ transform: scale(1.02); }

    /* Top row */
    .top-row{
      display:flex; align-items:center; gap:12px; margin-bottom:6px; flex-wrap:wrap;
    }
    .top-row .flex-spacer{ flex:1; }
    .page-subtitle{ font-size:20px; font-weight:bold; }

    .right-tools{ margin-left:auto; display:flex; align-items:center; gap:10px; }
    .search-form { display:flex; }
    .search-input{
      padding:10px; border-radius:6px 0 0 6px; border:1px solid #ccc; width:250px; background:#fff;
    }
    .search-btn{
      background-color:#E8E6F1; border:1px solid #ccc; border-left:none; padding:10px 14px;
      border-radius:0 6px 6px 0; cursor:pointer;
    }

    /* Count badge below */
    .count-pill{
      background:none;
      border:none;
      padding:4px 0;
      font-size:15px;
      color:#333;
      margin-top:4px;
      display:block;
    }

    /* Table card */
    .table-card{
      background:#fff; border-radius:10px; padding:16px; border:1px solid var(--border);
    }
    table { width:100%; border-collapse:collapse; }
    th, td { text-align:left; padding:12px 10px; font-size:14px; border-bottom:1px solid var(--border); }
    th { background-color:#F9F9F9; font-weight:bold; }
    .status-badge{
      display:inline-block; padding:4px 10px; border-radius:14px; font-size:12px;
      background:#d4edda; color:#28a745;
    }
    .status-inactive{ background:#fde2e1; color:#d43f3a; }

    /* Hide/Show sections */
    .hidden{ display:none; }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <img src="{% static 'images/logo.png' %}" alt="Logo" class="logo">
    <a href="{% url 'dashboard' %}"><i class="fa fa-angle-double-down" title="Dashboard"></i></a>
    <a href="{% url 'item_list' %}"><i class="fa fa-tags" title="Item List"></i></a>
    <a href="{% url 'reservation_verification' %}"><i class="fa fa-clipboard" title="Reserve Verification"></i></a>
    <a href="{% url 'history_logs' %}"><i class="fa fa-history" title="Reserve History List"></i></a>
    <a href="{% url 'damage_report' %}"><i class="fas fa-comment-alt" title="Damage Report"></i></a>
    <a href="{% url 'change_password' %}"><i class="fas fa-key" title="Change Password"></i></a> 
    <a href="{% url 'logout' %}"><i class="fa fa-sign-out" title="Log Out"></i></a>
  </div>

  <!-- Header -->
  <div class="header">Dashboard</div>

  <!-- Main -->
  <div class="main">

    <!-- ================= OVERVIEW (default) ================= -->
    <section id="overviewSection">
      <h1 class="page-title">Welcome, Admin!</h1>
      <p class="sub-muted">Total Users: <strong>{{ total_users|default:"0" }}</strong></p>

      <div class="cards">
        <!-- Instructor card -->
        <a class="card" href="{% url 'dashboard' %}?view=instructors">
          <img class="card-img" src="{% static 'images/instructor.png' %}" alt="Instructor" />
        </a>

        <!-- Student card -->
        <a class="card" href="{% url 'dashboard' %}?view=students">
          <img class="card-img" src="{% static 'images/student.png' %}" alt="Student" />
        </a>
      </div>
    </section>

    <!-- ================= INSTRUCTORS LIST ================= -->
    <section id="instructorsSection" class="hidden">
      <div class="top-row">
        <div class="flex-spacer"></div>
        <!-- Search -->
        <div class="right-tools">
          <form class="search-form" method="get" action="{% url 'dashboard' %}">
            <input type="hidden" name="view" value="instructors" />
            <input class="search-input" type="text" name="q" value="{{ query|default:'' }}" placeholder="Search instructor..." />
            <button class="search-btn" type="submit"><i class="fa fa-search"></i></button>
          </form>
        </div>
      </div>
      <span class="count-pill">Total List of Instructor: <strong>{{ instructor_count|default:"0" }}</strong></span>

      <div class="table-card">
        <table>
          <thead>
            <tr>
              <th>INSTRUCTOR ID</th>
              <th>INSTRUCTOR NAME</th>
              <th>INSTRUCTOR EMAIL</th>
              <th>DATE CREATED</th>
              <th>STATUS</th>
            </tr>
          </thead>
          <tbody>
            {% if instructors %}
              {% for p in instructors %}
                <tr>
                  <td>{{ p.user.username }}</td>
                  <td>{{ p.full_name }}</td>
                  <td>{{ p.user.email }}</td>
                  <td>{{ p.user.date_joined|date:"Y-m-d" }}</td>
                  <td>
                    <span class="status-badge {% if not p.user.is_active %}status-inactive{% endif %}">
                      {% if p.user.is_active %}Active{% else %}Inactive{% endif %}
                    </span>
                  </td>
                </tr>
              {% endfor %}
            {% else %}
              <tr><td colspan="5" style="text-align:center; color:#666;">No instructors found.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </section>

    <!-- ================= STUDENTS LIST ================= -->
    <section id="studentsSection" class="hidden">
      <div class="top-row">
        <div class="flex-spacer"></div>
        <!-- Search -->
        <div class="right-tools">
          <form class="search-form" method="get" action="{% url 'dashboard' %}">
            <input type="hidden" name="view" value="students" />
            <input class="search-input" type="text" name="q" value="{{ query|default:'' }}" placeholder="Search student..." />
            <button class="search-btn" type="submit"><i class="fa fa-search"></i></button>
          </form>
        </div>
      </div>
      <span class="count-pill">Total List of Students: <strong>{{ student_count|default:"0" }}</strong></span>

      <div class="table-card">
        <table>
          <thead>
            <tr>
              <th>STUDENT ID</th>
              <th>STUDENT NAME</th>
              <th>STUDENT EMAIL</th>
              <th>DATE CREATED</th>
              <th>STATUS</th>
            </tr>
          </thead>
          <tbody>
            {% if students %}
              {% for p in students %}
                <tr>
                  <td>{{ p.user.username }}</td>
                  <td>{{ p.full_name }}</td>
                  <td>{{ p.user.email }}</td>
                  <td>{{ p.user.date_joined|date:"Y-m-d" }}</td>
                  <td>
                    <span class="status-badge {% if not p.user.is_active %}status-inactive{% endif %}">
                      {% if p.user.is_active %}Active{% else %}Inactive{% endif %}
                    </span>
                  </td>
                </tr>
              {% endfor %}
            {% else %}
              <tr><td colspan="5" style="text-align:center; color:#666;">No students found.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </section>

  </div> <!-- /main -->

  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);
      const view = (params.get('view') || 'overview').toLowerCase();

      document.getElementById('overviewSection').classList.add('hidden');
      document.getElementById('instructorsSection').classList.add('hidden');
      document.getElementById('studentsSection').classList.add('hidden');

      if (view === 'instructors') {
        document.getElementById('instructorsSection').classList.remove('hidden');
      } else if (view === 'students') {
        document.getElementById('studentsSection').classList.remove('hidden');
      } else {
        document.getElementById('overviewSection').classList.remove('hidden');
      }
    })();
  </script>

</body>
</html>
